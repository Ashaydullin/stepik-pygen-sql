# 4.6 Функции даты и времени Часть 1

# Временные интервалы

В SQL для работы с датой и временем часто используются временные интервалы. Они представляют собой короткий промежуток времени, выраженные в тех или иных единицах измерения (день, год, минута) и используются для арифметических операций вычисления с датой и временем. 

Для записи интервалов применяется следующий синтаксис:

```
INTERVAL <величина интервала> <единица измерения>
```

Единица измерения во временном интервале определяется ключевым словом. Нарпимер, день - это `DAY`, год - это `YEAR`, год и месяц - это `YEAR_MONTH`. Формат величины интервала напрямую зависит от единицы измерения. Для одиночных единиц измерения, таких как день или год, форматом величины является целое число. 

К примеру интервал в `1` год определяется следующим образом:

```
INTERVAL 1 YEAR
```

Для составных единиц измерения, таких как год и месяц, форматом величины является строка определенного вида, в которой перечисленны все необходимые значения компонентов.

К примеру интервал в `10` лет и `2` месяца определяется следующим образом:

```
INTERVAL '10-2' YEAR_MONTH
```

# Поддерживаемые единицы измерения

Первая таблица включает все поддерживаемые одиночные единицы измерения:
       
| Единица измерения | Ключевое слово |
|-------------------|----------------|
| микросекунда      | `MICROSECOND`  |
| секунда	        | `SECOND`       |
| минута            | `MINUTE`       |
| час               | `HOUR`         |
| день              | `DAY`          |
| неделя            | `WEEK`         |
| месяц             | `MONTH`        |
| квартал           | `QUARTER`      |
| год               | `YEAR`         |

Вторая таблица включает все поддерживаемые составные единицы измерения, а также формат величины для каждой из единиц:

| Единица измерения                         | Ключевое слово       | Формат величины                        |
|-------------------------------------------|----------------------|----------------------------------------|
| секунда и микросекунда                    | `SECOND_MICROSECOND` | `секунды.микросекунды`                 |
| минута, секунда и микросекунда            | `MINUTE_MICROSECOND` | `минуты:секунды.микросекунды`          |
| минута и секунда                          | `MINUTE_SECOND`      | `минуты:секунды`                       |
| час, минута, секунда и микросекунда       | `HOUR_MICROSECOND`   | `часы:минуты:секунды.микросекунды`     |
| час, минута и секунд                      | `HOUR_SECOND`        | `часы:минуты:секунды`                  |
| час и минута                              | `HOUR_MINUTE`        | `часы:минут`                           |
| день, час, минута, секунда и микросекунда	| `DAY_MICROSECOND`    | `дни часы:минуты:секунды.микросекунды` |
| день, час, минута и секунда               | `DAY_SECOND`         | `дни часы:минуты:секунды`              |
| день, час и минута                        | `DAY_MINUTE`         | `дни часы:минуты`                      |
| день и час                                | `DAY_HOUR`           | `дни часы`                             |
| год и месяц                               | `YEAR_MONTH`         | `годы-месяцы`                          |

# Примеры использования временных интервалов

#### Пример 1. 

Прибавим к дате `2023-01-01` в интервале `10` лет и `2` месяца.

Результатом запроса:

```
SELECT '2023-01-01' + INTERVAL '10-2' YEAR_MONTH;
```

будет:

```
+-------------------------------------------+
| '2023-01-01' + INTERVAL '10-2' YEAR_MONTH |
+-------------------------------------------+
| 2033-03-01                                |
+-------------------------------------------+
```

#### Пример 2. 

Вычтем из даты и времени `2023-01-01 14:00:00` интервал в `1` час и `30` минут

Результатом запроса:

```
SELECT '2023-01-01 14:00:00' - INTERVAL '01:30' HOUR_MINUTE;
```

будет:

```
+------------------------------------------------------+
| '2023-01-01 14:00:00' - INTERVAL '01:30' HOUR_MINUTE |
+------------------------------------------------------+
| 2023-01-01 12:30:00                                  |
+------------------------------------------------------+
```

#### Пример 3.

Прибавим к дате и времени `2023-01-01 14:00:00` интервал в `4` дня и `2` часа.

Результатом будет:

```
SELECT '2023-01-01 14:00:00' + INTERVAL '4 2' DAY_HOUR;
```

будет:

```
+-------------------------------------------------+
| '2023-01-01 14:00:00' + INTERVAL '4 2' DAY_HOUR |
+-------------------------------------------------+
| 2023-01-05 16:00:00                             |
+-------------------------------------------------+
```

#### Пример 4.

Вычтем из даты `2023-01-01` интервал в `1` час.

Результатом запроса:

```
SELECT '2023-01-01' - INTERVAL 1 HOUR;
```

будет:

```
+--------------------------------+
| '2023-01-01' - INTERVAL 1 HOUR |
+--------------------------------+
| 2022-12-31 23:00:00            |
+--------------------------------+
```

Из даты без времени допускается вычитать временное значение. Во время выполнения такой операции, считается, что дата имеет нулевые значения по всем компонентам времени.

# Функции NOW(), CURDATE() и CURTIME()

Функция `NOW()` используется для получения текущей даты и времени. Не принимает никаких аргументов и возвращает текущую дату и время в локальном часовом поясе. 

Результатом запроса:

```
SELECT NOW();
```

может быть:

```
+---------------------+
| NOW()               |
+---------------------+
| 2023-06-27 10:14:48 |
+---------------------+
```

Похожим образом ведут себя функции `CURDATE()` и `CURTIME()` за тем исключением, что они возвращают текущую дату и текущее время соответственно.

Результатом запроса:

```
SELECT CURTIME(),
       CURDATE();
```

может являться:

```
+-----------+------------+
| CURTIME() | CURDATE()  |
+-----------+------------+
| 10:23:15  | 2023-06-27 |
+-----------+------------+
```

# Функции UTC_TIMESTAMP(), UTC_DATE() и UTC_TIME()

Функция `UTC_TIMESTAMP()` используется для получения текущей даты и времени, не принимает никаких аргументов и возвращает текущую дату и время в UTC, то есть в нулевом часовом поясе.

Результатом запроса:

```
SELECT UTC_TIMESTAMP();
```

может быть:

```
+---------------------+
| UTC_TIMESTAMP()     |
+---------------------+
| 2023-06-28 05:44:53 |
+---------------------+
```

Так же ведут себя и другие `UTC_*` функции которые возвращают значения в соответствии со своим названием.

Результатом запроса:

```
SELECT UTC_DATE(),
       UTC_TIME();
```

может быть:

```
+------------+------------+
| UTC_DATE() | UTC_TIME() |
+------------+------------+
| 2023-10-17 | 13:57:34   |
+------------+------------+
```

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
Во время работы с датой и временем рекомендуется использовать именно UTC-функции, а приведение к какому-либо часовому поясу выполнять вручную.
</p>
</div>
</kbd>

# Функция MAKEDATE()

Функция `MAKEDATE()` используется для создания даты. Она принимает два аргумента в следующем порядке:

* `year` - год
* `day` - номер дня в году

Функция возвращает дату, которая имеет порядковый номер `day` в году `year`.

Результатом запроса:

```
SELECT MAKEDATE(2023, 1),
       MAKEDATE(2023, 255),
       MAKEDATE(2023, 365);
```

будет:

```
+-------------------+---------------------+---------------------+
| MAKEDATE(2023, 1) | MAKEDATE(2023, 255) | MAKEDATE(2023, 365) |
+-------------------+---------------------+---------------------+
| 2023-01-01        | 2023-09-12          | 2023-12-31          |
+-------------------+---------------------+---------------------+
```

Если указанный номер дня в году больше количества дней в этом году, функция `MAKEDATE()` преобразует каждые 365-366 дней в полный год.

Результатом запроса:

```
SELECT MAKEDATE(2023, 366),
       MAKEDATE(2023, 732);
```

будет:

```
+---------------------+---------------------+
| MAKEDATE(2023, 366) | MAKEDATE(2023, 732) |
+---------------------+---------------------+
| 2024-01-01          | 2025-01-01          |
+---------------------+---------------------+
```

# Функция MAKETIME()

Функция `MAKETIME()` используется для создания временного значения. Она принимает три аргумента в следующем порядке:

* `hours` - часы
* `minutes` - минуты
* `seconds` - секунды 

Функция возвращает временное значение, состоящее из `hours` часов, `minutes` минут и `seconds` секунд.

Результатом запроса:

```
SELECT MAKETIME(12, 33, 1),
       MAKETIME(0, 1, 2),
       MAKETIME(21, 11, 42);
```

будет:

```
+---------------------+-------------------+----------------------+
| MAKETIME(12, 33, 1) | MAKETIME(0, 1, 2) | MAKETIME(21, 11, 42) |
+---------------------+-------------------+----------------------+
| 12:33:01            | 00:01:02          | 21:11:42             |
+---------------------+-------------------+----------------------+
```

Функция `MAKETIME()` может обрабатывать значения часов больше, чем есть в сутках, но не может обрабатывать значение минут и секунд больше `59`. Если количество минут или секунд больше `59`, функция вернет значение `NULL`.

Результатом запроса:

```
SELECT MAKETIME(222, 50, 11),
       MAKETIME(10, 60, 12),
       MAKETIME(5, 33, 79);

```

```
+-----------------------+----------------------+---------------------+
| MAKETIME(222, 50, 11) | MAKETIME(10, 60, 12) | MAKETIME(5, 33, 79) |
+-----------------------+----------------------+---------------------+
| 222:50:11             | NULL                 | NULL                |
+-----------------------+----------------------+---------------------+
```

# Функции TIME_TO_SEC() и SEC_TO_TIME()

Функция `TIME_TO_SEC()` используются для преобразования временного значения в секунды и принимает в качестве аргумента временное значение, преобразует его в количество секунд и возвращает полученный результат.

Результатом запроса:

```
SELECT TIME_TO_SEC('00:00:25'),
       TIME_TO_SEC('00:01:30'),
       TIME_TO_SEC('01:00:00');
```

будет:

```
+-------------------------+-------------------------+-------------------------+
| TIME_TO_SEC('00:00:25') | TIME_TO_SEC('00:01:30') | TIME_TO_SEC('01:00:00') |
+-------------------------+-------------------------+-------------------------+
| 25                      | 90                      | 3600                    |
+-------------------------+-------------------------+-------------------------+
```

Похожим образом ведет себя функция `SEC_TO_TIME()` за тем исключением, что она выполняет обратное преобразование - количество секунд во временное значение:

```
SELECT SEC_TO_TIME(25),
       SEC_TO_TIME(90),
       SEC_TO_TIME(3600);
```

будет:

```
+-----------------+-----------------+-------------------+
| SEC_TO_TIME(25) | SEC_TO_TIME(90) | SEC_TO_TIME(3600) |
+-----------------+-----------------+-------------------+
| 00:00:25        | 00:01:30        | 01:00:00          |
+-----------------+-----------------+-------------------+
```

# Функции TO_DAYS() и TO_SECONDS()

Функция `TO_DAYS()` используется для преобразования даты в количество дней. Она принимает в качестве аргумента дату, преобразует ее в количество дней и возвращает полученный результат.

Результатом запроса:

```
SELECT TO_DAYS('2023-04-01'),
       TO_DAYS('0001-01-01'),
       TO_DAYS('0000-01-01');
```

будет:

```
+-----------------------+-----------------------+-----------------------+
| TO_DAYS('2023-04-01') | TO_DAYS('0001-01-01') | TO_DAYS('0000-01-01') |
+-----------------------+-----------------------+-----------------------+
| 738976                | 366                   | 1                     |
+-----------------------+-----------------------+-----------------------+
```

Обратите внимание, что отсчет количества дней начинается с нулевого года.

Похожим образом себя ведет функция `TO_SECONDS()`, за тем исключением, что она преобразует дату в количество секунд, а не дней.

Результатом запроса:

```
SELECT TO_SECONDS('2023-04-01'),
       TO_SECONDS('0001-01-01'),
       TO_SECONDS('0000-01-01');
```

будет:

```
+--------------------------+--------------------------+--------------------------+
| TO_SECONDS('2023-04-01') | TO_SECONDS('0001-01-01') | TO_SECONDS('0000-01-01') |
+--------------------------+--------------------------+--------------------------+
| 63847526400              | 31622400                 | 86400                    |
+--------------------------+--------------------------+--------------------------+
```

# Функция LAST_DAY()

Функция `LAST_DAY()` используется для замены дня на последний день месяца. Принимает в качестве аргумента дату, заменяет в ней день на последний день месяца этой даты и возвращает полученный результат. 

Результатом запроса:

```
SELECT LAST_DAY('2023-02-14'),
       LAST_DAY('2023-03-14'),
       LAST_DAY('2023-04-14');
```

будет:

```
+------------------------+------------------------+------------------------+
| LAST_DAY('2023-02-14') | LAST_DAY('2023-03-14') | LAST_DAY('2023-04-14') |
+------------------------+------------------------+------------------------+
| 2023-02-28             | 2023-03-31             | 2023-04-30             |
+------------------------+------------------------+------------------------+
```

#### Примечание 1.

Если хотя бы один из аргументов, переданных в функции `MAKEDATE()` и `MAKETIME()`, являeтся значением `NULL`, функции вернут значение `NULL`.

Результатом запроса:

```
SELECT MAKETIME(NULL, 1, 1),
       MAKETIME(1, NULL, 1),
       MAKETIME(1, 1, NULL),
       MAKEDATE(2023, NULL),
       MAKEDATE(NULL, 9);
```

будет:

```
+----------------------+----------------------+----------------------+----------------------+-------------------+
| MAKETIME(NULL, 1, 1) | MAKETIME(1, NULL, 1) | MAKETIME(1, 1, NULL) | MAKEDATE(2023, NULL) | MAKEDATE(NULL, 9) |
+----------------------+----------------------+----------------------+----------------------+-------------------+
| NULL                 | NULL                 | NULL                 | NULL                 | NULL              |
+----------------------+----------------------+----------------------+----------------------+-------------------+
```

#### Примечание 2.

Функции TIME_TO_SEC(), SEC_TO_TIME(), TO_DAYS(), TO_SECONDS() и LAST_DAY() при вызове с аргументом NULL возвращают значение NULL.

Результатом запроса:

```
SELECT TIME_TO_SEC(NULL),
       SEC_TO_TIME(NULL),
       TO_DAYS(NULL),
       TO_SECONDS(NULL),
       LAST_DAY(NULL);
```

будет:

```
+-------------------+-------------------+---------------+------------------+----------------+
| TIME_TO_SEC(NULL) | SEC_TO_TIME(NULL) | TO_DAYS(NULL) | TO_SECONDS(NULL) | LAST_DAY(NULL) |
+-------------------+-------------------+---------------+------------------+----------------+
| NULL              | NULL              | NULL          | NULL             | NULL           |
+-------------------+-------------------+---------------+------------------+----------------+
```
