# 3.3 Сортировка данных

Используемая база данных:

```
+----+-------+----------------------+------------+---------+--------------+
| id | place | trackname            | artist     | streams | release_date |
+----+-------+----------------------+------------+---------+--------------+
| 1  | 4     | Crazy On You         | Heart      | 76338   | 2009-12-19   |
| 2  | 3     | My Lover             | The Sounds | 99488   | 2009-05-31   |
| 3  | 2     | Running up That Hill | Kate Bush  | 121495  | 1985-08-05   |
| 4  | 5     | Thrill               | The Sounds | 49345   | 2016-11-11   |
| 5  | 1     | Spent the Day in Bed | Morrissey  | 174994  | 2017-10-17   |
+----+-------+----------------------+------------+---------+--------------+
```

# Оператор ORDER BY

Часто при извлечении данных в результирующую таблицу, необходимо получить отсортированные данные. В этом нам поможет оператор `ORDER BY`. Чтобы извлечь информацию из базы данных в отсортированном виде, достаточно указать `ORDER BY` и имя сортируемого поля. 

Результатом запроса:

```
SELECT artist, trackname, release_date
FROM Songs
ORDER BY release_date;
```

будет:

```
+------------+----------------------+--------------+
| artist     | trackname            | release_date |
+------------+----------------------+--------------+
| Kate Bush  | Running up That Hill | 1985-08-05   |
| The Sounds | My Lover             | 2009-05-31   |
| Heart      | Crazy On You         | 2009-12-19   |
| The Sounds | Thrill               | 2016-11-11   |
| Morrissey  | Spent the Day in Bed | 2017-10-17   |
+------------+----------------------+--------------+
```

В этом примере извлекается информация о песнях, однако данные расположены не в произвольном порядке, по умолчанию `ORDER BY` сортирует по возрастанию, как мы это можем увидеть глядя в `release_date`. 

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч"  alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
В запросе оператор ORDER BY должен следовать после операторов SELECT и FROM, иначе запрос завершится с ошибкой
</p>
</div>
</kbd>

# Сортировка по нескольким полям

Чаще всего сортировки по одному полю бывает недостаточно, так как несколько записей могут содержать одно и то же значение в том поле, по которому выполняется сортировка. Чтобы выполнить сортировку по нескольким полям, нужно перечислить их через запятую.

Результатом запроса:

```
SELECT artist, trackname, streams
FROM Songs
ORDER BY artist, streams;
```

будет:

```
+------------+----------------------+---------+
| artist     | trackname            | streams |
+------------+----------------------+---------+
| Heart      | Crazy On You         | 76338   |
| Kate Bush  | Running up That Hill | 121495  |
| Morrissey  | Spent the Day in Bed | 174994  |
| The Sounds | Thrill               | 49345   |
| The Sounds | My Lover             | 99488   |
+------------+----------------------+---------+
```

Запрос сначала выполняет сортировку по полю `artist`, затем по полю `streams`. Если какие либо две записи имеют разные значения в поле `artist`, они сортируются согласно этим значениям. Если какие-либо две записи имеют одинаковые значения в поле `artist`, они сортируются согласно значениям в поле `streams`.

# Сортировка по положению поля

Вместо имен полей, оператор `ORDER BY` позволяет указывать порядковый номер полей, по которым необходимо выполнить сортировку. Однако сортировка таким методом возможно только по тем полям, которые присутствуют в результирующей таблице. Нумеруются поля с единицы, первое поле результирующей таблицы имеет порядковый номер `1` второе `2` и тд.

Например запрос:

```
SELECT artist, trackname, streams
FROM Songs
ORDER BY artist, streams;
```

можно записать следующим образом:

```
SELECT artist, trackname, streams
FROM Songs
ORDER BY 1, 3;
```

И получится аналогичный результат:

```
+------------+----------------------+---------+
| artist     | trackname            | streams |
+------------+----------------------+---------+
| Heart      | Crazy On You         | 76338   |
| Kate Bush  | Running up That Hill | 121495  |
| Morrissey  | Spent the Day in Bed | 174994  |
| The Sounds | Thrill               | 49345   |
| The Sounds | My Lover             | 99488   |
+------------+----------------------+---------+
```

Второй запрос отличается от первого лишь тем что используются порядковые номера полей в результирующей таблице а не их имена. Поле `artist` = `1`, поле `streams` = `3`.

# Указание направления сортировки

Сортировать данные можно как по возрастанию так и по убыванию. Для сортировки в порядке убывания используется оператор `DESC`.

Результатом запроса:

```
SELECT place, trackname
FROM Songs
ORDER BY place DESC;
```

будет:

```
+-------+----------------------+
| place | trackname            |
+-------+----------------------+
| 5     | Thrill               |
| 4     | Crazy On You         |
| 3     | My Lover             |
| 2     | Running up That Hill |
| 1     | Spent the Day in Bed |
+-------+----------------------+
```

В этом примере данные сортируются по убыванию значения поля `place`. 

Важной особенностью ключевого слова `DESC` является то, что оно применяется только к тому полю, после которого стоит. Это необходимо учитывать при сортировке по нескольким полям.

Результатом запроса:

```
SELECT id, artist, trackname
FROM Songs
ORDER BY artist, id DESC;
```

будет:

```
+----+------------+----------------------+
| id | artist     | trackname            |
+----+------------+----------------------+
| 1  | Heart      | Crazy On You         |
| 3  | Kate Bush  | Running up That Hill |
| 5  | Morrissey  | Spent the Day in Bed |
| 4  | The Sounds | Thrill               |
| 2  | The Sounds | My Lover             |
+----+------------+----------------------+
```

Здесь сортировка выполняется по полям `artist` и `id`. Ключевое слово `DESC` указано лишь после поля `id`, поэтому сортировка происходит в порядке **возрастания** значения поля `artist`, а в случае совпадения - в порядке **убывания** значения поля `id`. 

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч"  alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
Если необходимо отсортировать записи в порядке убывания значений нескольких полей, нужно обязательно указывать оператор `DESC` после каждого из них.
</p>
</div>
</kbd>

#### Примечание 1.

Аналогично сортировке в порядке **убывания** оператором `DESC` существует оператор для сортировки в порядке **возрастания** `ASC`, использовать которое не обязательно.

Приведеннный ниже запрос:

```
SELECT title
FROM Songs
ORDER BY title;
```

Полностью идентичен следующему:

```
SELECT title
FROM Songs
ORDER BY title ASC;
```

#### Примечание 2.

Операторы `ORDER BY` и `LIMIT` могут использоваться вместе для решения различных задач. Например с их помощью можно определить две песни, вышедших позже остальных. Для этого сперва необходимо отсортировать музыкальные композиции в порядке убывания даты их выхода, а затем ограничить полученный результат до двух значений.

Результатом приведенного запроса:

```
SELECT artist, trackname, release_date
FROM Songs
ORDER BY release_date DESC
LIMIT 2;
```

будет:

```
+------------+----------------------+--------------+
| artist     | trackname            | release_date |
+------------+----------------------+--------------+
| Morrissey  | Spent the Day in Bed | 2017-10-17   |
| The Sounds | Thrill               | 2016-11-11   |
+------------+----------------------+--------------+
```

Подобные манипуляции с данными возможны благодаря порядку, в котором запрос выполняет свои операции. Сначала происходит выборка из `SONGS` затем сортировка с помощью `ORDER BY` и `DESC`, только после этого применяется ограничение вывода с помощью `LIMIT`.

#### Примечание 3.

Сортировка является одной из завершающих операций и выполняется уже после формирования результирующей таблицы, поэтому в блоке оператора `ORDER BY` можно указывать как фактические имена полей таблицы, из которой извлекаются данные так и псевдонимы.

Результатом запроса:

```
SELECT artist, trackname AS track, release_date
FROM Songs
ORDER BY track;
```

будет:

```
+------------+----------------------+--------------+
| artist     | track                | release_date |
+------------+----------------------+--------------+
| Heart      | Crazy On You         | 2009-12-19   |
| The Sounds | My Lover             | 2009-05-31   |
| Kate Bush  | Running up That Hill | 1985-08-05   |
| Morrissey  | Spent the Day in Bed | 2017-10-17   |
| The Sounds | Thrill               | 2016-11-11   |
+------------+----------------------+--------------+
```

Если псевдоним состоит из нескольких слов, то при сортировке его обязательно нужно заключать в обратные апострофы(` `` `) 

Результатом запроса:

```
SELECT artist, trackname AS 'track name'
FROM Songs
ORDER BY `track name`;
```

будет:

```
+------------+----------------------+
| artist     | track name           |
+------------+----------------------+
| Heart      | Crazy On You         |
| The Sounds | My Lover             |
| Kate Bush  | Running up That Hill |
| Morrissey  | Spent the Day in Bed |
| The Sounds | Thrill               |
+------------+----------------------+
```

#### Примечание 4.

Ключевое слово `DESC` - это сокращение от `DESCENDING` (убывание). Его антоним `ASC` - сокращение от `ASCENDING` (возрастание).


#### Примечание 5.

При сортировке строковых значений, регистр не учитывается. Данное поведение можно изменить в настройках СУБД, однако выбирать учитывать регистр или нет, с помощью оператора `ORDER BY` нельзя.

---