# 3.2 Извлечение данных

# Запросы и операторы

**SQL-запрос** представляет собой команду которую мы отправляем базе данных для решения определенных задач, таких как изменение, добавление, удаление. Каждый запрос состоит из **операторов** определяющих необходимые действия.

Операторы также называют **ключевыми словами**. Они представляют собой зарезервированные слова, которые имеют специальное значение и выполняют определенные функции в синтаксисе языка **SQL**. **Операторы не могут быть использованы в качестве имен таблиц, полей и других объектов базы данных.**

Запрос ниже извлекает из таблицы `Songs` все записи, которые в качестве значения поля `streams` имеют целочисленное значение которое превышает 100000:

```
SELECT *
FROM Songs
WHERE streams > 100000;
```

Запрос состоит из ключевых слов `SELECT`, `FROM`, `WHERE` и заканчивается символом `;` который символизирует конец операции. SQL-запросы могут быть сложными и состоять из нескольких операций, для разделения друг друга используется символ `;`. 

Запрос ниже создает таблицу с именем `Songs`, добавляет в нее две записи, наполняет данными а затем извлекает из нее информацию.

```
CREATE TABLE Songs                               -- операция создания таблицы
(
    id        INT PRIMARY KEY AUTO_INCREMENT,
    trackname VARCHAR(30),
    artist    VARCHAR(30)
);                                               -- завершение операции

INSERT INTO Songs (trackname, artist)            -- операция наполнения таблицы
VALUES ('Crazy On You', 'Heart'),
       ('My Lover', 'The Sounds');               -- завершение операции

SELECT *                                         -- операция извлечения данных из таблицы
FROM Songs;   
```

# Оператор SELECT

Чаще всего задачи которые обычно приходится выполнять с базой данных сводятся к извлечению необходимой информации. Получение конкретной записи, находящейся в одной из таблиц или несколько записей удовлетворяющих определенным условиям. За все подобные задачи связанные с получением данных отвечает оператор - `SELECT`.

Чтобы при помощи оператора `SELECT` извлечь данные из базы, нужно указать как минимум две вещи: что именно нужно извлечь и откуда. Простейший запрос который извлекает одно определенное поле из таблицы:

```
SELECT trackname
FROM Songs;
```

Результат:

```
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```

Здесь оператор `SELECT` извлекает поле `trackname` из таблицы `Songs`. Имя поля указывается сразу после ключевого слова `SELECT`, а ключевое слово `FROM` указывает на таблицу, из которой извлекаются данные. Этот запрос извлекает все записи таблицы не выполняя фильтрации.

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч"  alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
Операторы не чувствительны к регистру, записи SELECT, select и Select эквивалентны. Чаще всего используется верхний регистр
</p>
</div>
</kbd>

Для извлечения нескольких полей из таблицы, нужно через запятую перечислить их имена:

```
SELECT trackname, artist, streams
FROM Songs;
```

Результат:

```
+----------------------+------------+---------+
| trackname            | artist     | streams |
+----------------------+------------+---------+
| Crazy on You         | Heart      | 76338   |
| My Lover             | The Sounds | 99488   |
| Running up That Hill | Kate Bush  | 121495  |
| Thrill               | The Sounds | 49345   |
| Spent the Day in Bed | Morrissey  | 174994  |
+----------------------+------------+---------+
```

Поля возвращаются в том порядке в котором они были указаны в запросе:

```
SELECT streams, artist, trackname
FROM Songs;
```

Результат:

```
+---------+------------+----------------------+
| streams | artist     | trackname            |
+---------+------------+----------------------+
| 76338   | Heart      | Crazy on You         |
| 99488   | The Sounds | My Lover             |
| 121495  | Kate Bush  | Running up That Hill |
| 49345   | The Sounds | Thrill               |
| 174994  | Morrissey  | Spent the Day in Bed |
+---------+------------+----------------------+
```

C помощью оператора `SELECT` можно запросить все поля не указывая каждое из них. Для этого вместо имён используется специальный групповой символ `*` : 

```
SELECT *
FROM Songs;
```

Результат:

```
+----+----------+----------------------+------------+---------+
| id | place    | trackname            | artist     | streams |
+----+----------+----------------------+------------+---------+
| 1  | 4        | Crazy on You         | Heart      | 76338   |
| 2  | 3        | My Lover             | The Sounds | 99488   |
| 3  | 2        | Running up That Hill | Kate Bush  | 121495  |
| 4  | 5        | Thrill               | The Sounds | 49345   |
| 5  | 1        | Spent the Day in Bed | Morrissey  | 174994  |
+----+----------+----------------------+------------+---------+
```

Символ `*` не так часто используется на практике, так как показывает все поля что снижает производительность запроса. Но есть одно преимущество, для нахождения неизвестных полей. 

# Извлечение уникальных записей

При извлечении одного или нескольких полей таблицы могут встречаться повторяющиеся значения, тогда в результирующей таблице они также будут повторяться. 

Результатом запроса:

```
SELECT artist
FROM Songs;
```

будет:

```
+------------+
| artist     |
+------------+
| Heart      |
| The Sounds |
| Kate Bush  |
| The Sounds |
| Morrissey  |
+------------+
```

Чтобы извлечь только уникальные записи необходимо воспользоваться ключевым словом `DISTINCT`, которое указывается перед именами всех полей .

Результатом запроса:

```
SELECT DISTINCT artist
FROM Songs;
```

будет:

```
+------------+
| artist     |
+------------+
| Heart      |
| The Sounds |
| Kate Bush  |
| Morrissey  |
+------------+
```

Ключевое слово `DISTINCT` применяется ко всем полям, а не только к тому, перед которым оно стоит, поэтому при его использовании для двух и более полей одинаковыми будут считаться лишь те записи, которые имеют одинаковые значения по всем полям. 

Результатом запроса:

```
SELECT DISTINCT trackname, artist
FROM Songs;
```

будет:

```
+----------------------+------------+
| trackname            | artist     |
+----------------------+------------+
| Crazy on You         | Heart      |
| My Lover             | The Sounds |
| Running up That Hill | Kate Bush  |
| Thrill               | The Sounds |
| Spent the Day in Bed | Morrissey  |
+----------------------+------------+
```

Здесь вторая и четвертая запись считаются разными, так как их значения не совпадают по всем полям, а только по одному.

# Ограничение результатов запроса

При извлечении данных из таблицы, может потребоваться получить определенное количество записей, например 1. Сделать это можно с помощью ключевого слова `LIMIT`.

Результатом запроса:

```
SELECT trackname
FROM Songs
LIMIT 3;
```

будет:

```
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
+----------------------+
```

Запрос извлекает поле `trackname` а выражение `LIMIT 3` говорит о том , что должно быть извлечено не более трех записей. Если же необходимо получить следующие три записи, можно задать точку извлечения с помощью ключевого слова `OFFSET`. 

Результатом запроса:

```
SELECT trackname
FROM Songs
LIMIT 3
OFFSET 2;
```

будет:

```
+----------------------+
| trackname            |
+----------------------+
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```

Выражение `LIMIT 3 OFFSET 2` говорит о том, что должно быть извлечено три записи, начиная с записи с индексом два. Таким образом, первое число - это количество строк для извлечения, а второе - начальная точка. 

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч"  alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
Записи при использовании ключевого слова OFFSET индексируются с нуля, поэтому, например выражение LIMIT 1 OFFSET 1 вернет вторую запись, а не первую
</p>
</div>
</kbd>

Ключевое слово `LIMIT` лишь ограничивает количество извлекаемых записей, а не определяет их количество.
Например, если в таблице содержится пять записей, а ограничивающим значением является число десять, то извлечены будут все пять записей и только они. 

Результатом запроса:

```
SELECT trackname
FROM Songs
LIMIT 10;
```

будет:

```
+----------------------+
| trackname            |
+----------------------+
| Crazy on You         |
| My Lover             |
| Running up That Hill |
| Thrill               |
| Spent the Day in Bed |
+----------------------+
```

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч"  alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
Ключевое слово OFFSET используется только в паре с ключевым словом LIMIT
</p>
</div>
</kbd>

# Псевдонимы

При извлечении полей таблицы они сохраняют исходные наименования в результирующей таблице, при необходимости можно воспользоваться **псевдонимами**, чтобы дать альтернативные имена. Делается это с помощью ключевого слова `AS`, которое располагается между исходным именем поля и новым.

Результатом запроса:

```
SELECT trackname AS 'Song name',
       artist AS Artist
FROM Songs;
```

будет:

```
+----------------------+------------+
| Song name            | Artist     |
+----------------------+------------+
| Crazy On You         | Heart      |
| My Lover             | The Sounds |
| Running up That Hill | Kate Bush  |
| Thrill               | The Sounds |
| Spent the Day in Bed | Morrissey  |
+----------------------+------------+
```

**Обратите внимание: если псевдоним состоит из нескольких слов, он должен быть представлен строкой, заключенной в апострофы.**

<kbd>
<div style="display:flex; align-items:center;">
<img src= "../bee.png" alt="пчелыч"  alt="пчелыч" style="width:50px; height:50px; margin-right:20px;">
<p>
Псевдонимы могут содержать до 255 знаков, включая пробелы, цифры и специальные символы.
</p>
</div>
</kbd>

#### Примечание 1.

Записи в результирующей таблице могут отображаться в произвольном порядке. И это нормальное поведение, например это может быть порядок, в котором запись заносилась в таблицу. Главное чтобы запрос возвращал одни и те же записи.

#### Примечание 2.

Все лишние пробельные символы в запросе пропускаются при его обработке, поэтому запрос может быть записан как в одной длинной строке , так и разбит на несколько строк. 

Приведенные ниже запросы функционально полностью эквивалентны:

- ```
  SELECT trackname
  FROM Songs;
  ```

- ```
  SELECT trackname FROM Songs;
  ```

- ```
  SELECT
  trackname
  FROM
  Songs;
  ```

#### Примечание 3.

Оператор `SELECT` может использоваться не только для извлечения данных из базы, но и для вывода конкретных значений.

Например:

```
SELECT 'beegeek';
```

Результат:

```
+---------+
| beegeek |
+---------+
| beegeek |
+---------+
```

или:

```
SELECT 100, 200, 300;
```

Результат:

```
+-----+-----+-----+
| 100 | 200 | 300 |
+-----+-----+-----+
| 100 | 200 | 300 |
+-----+-----+-----+
```

#### Примечание 4. 

Как и во многих других языках, SQL поддерживает однострочные и многострочные комментарии.

Однострочные комментарии обозначаются двумя дефисами `(--)`:

```
-- это комментарий

SELECT trackname    -- это комментарий
FROM Songs;
```

Многострочные комментарии обрамляются сочетанием символов `/*`:

```
/* это
многострочный
комментарий */

SELECT trackname
FROM Songs;
```

---